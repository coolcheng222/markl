# Linux

> [TOC]

## 零.绪论

![image-20200218192501911](C:\Users\carrzhou\AppData\Roaming\Typora\typora-user-images\image-20200218192501911.png)

### 1. 硬件设备文件名/系统分区

(如上图)

> 举例:/dev/hda1
>
> a->第一块硬盘,1->第一个分区

现在ide硬盘很少见了,所以`hd`其实很少见

* 1234这四个分区号只能给主分区或拓展分区使用
* 主分区与拓展分区之和最大为4, 5总是代表第一个逻辑分区
* 拓展分区不能读写,拓展分区包含的逻辑分区可以读写

### 2.挂载

window中的`盘符`在linux中称为`挂载点`.在linux中挂载点一般是空的字符串

* 必须分区:

  1. /(根分区)

  2. swap分区(交换分区,内存2倍,不超过2GB)
* 推荐分区
  1. /boot(启动分区,800Mb)

![image-20200218193534697](C:\Users\carrzhou\AppData\Roaming\Typora\typora-user-images\image-20200218193534697.png)

> 每个目录可以有独立的存储空间,而不是windows一样的共用存储空间

### 3.随机知识

BIOS:主板自带操作系统

ifconfig:查ip命令

### 4, 远程登录管理工具

~~输了~~

### 5. 扩展名:

linux__没有拓展名__

但为了帮助记忆,有如下约定:

> 压缩包: *.gz *.bz2	*.tar.bz2	*.tgz
>
> 二进制软件包: *.rpm
>
> 网页文件: *.html	*.php
>
> 脚本文件:*.sh
>
> 配置文件:*.conf

### 6. 目录

| 目录名       | 作用                                                      |
| ------------ | --------------------------------------------------------- |
| /bin/        | 存放系统命令的目录                                        |
| /sbin/       | 保存和系统环境设置相关的命令,只有超级用户可以使用这些命令 |
| /usr/bin/    | 存放系统命令的目录,在单用户模式不能执行                   |
| /boot/       | 开机目录                                                  |
| /dev/        | 设备                                                      |
| /etc/        | 配置文件保存位置                                          |
| /usr/sbin/   | 保存不必要的目录                                          |
| /home/       | 用户的家目录                                              |
| /lib/        | 函数库                                                    |
| /lost,found/ | 丢失找到,崩溃后的碎片存在这里                             |
| /media/      | 挂载目录,挂载媒体设备                                     |
| /mnt/        | 挂载目录,挂载U盘,移动一盘                                 |
| /misc/       | 挂载目录,挂载NFS服务的共享目录                            |
| /opt/        | `用得不多`,更习惯放在/usr/local中                         |
| /usr/        | 系统资源目录                                              |

## 一.常用命令

### 1. 文件处理命令

命令基本格式: 命令 [-选项] [参数]

选项:简化与完整: 如-a等于 --all

#### 1. 1 ls

* 命令原意: list
* 所在路径: /bin/ls
* 执行权限 : 所有用户
* 选项:
  * `-l`   长格式long
  * `-a` 所有(all)
  * `-d`显示当前目录本身
  * `-h` 人性化显示
  * `-i` 显示inode目录号

##### 1.1.1 长格式

以`-rw-r--r--`为例

* 第一个字符是文件类型:

  * `-` 二进制文件

  * `d`目录

  * `l`连接
* 后面的是权限

  * `r`读

  * `w`写

  * `x`执行
* 每个名称有三个组分别对应三种用户的权限
  * `u`所有者
  * `g`所属组
  * `o`其他人



#### 1.2. 目录

* **mkdir**
* 创建新目录
  
* 选项:
  
  * `-p`递归创建(创建目录/目录/...)
  
    * 可以通过空格分隔创建多个目录
    
  * 所在路径: /bin/mkdir/
    
  * 权限:所有用户
  
* **cd(change directory)**
  * 改变目录
  * cd ..回到上级目录
  * \cd 强制覆盖
  
* **pwd**
  * ==显示当前==目录
  * `.`是当前目录,`..`是上级目录
  
* **rmdir** 
*  删除空目录(非空不能删)
  
* __cp__
  * ==复制==目录
  
  * cp -rp [原文件目录]\[目标目录]
  
  * 选项:
    * `-r` 复制目录
    * `-p` 保留文件属性
    
  * 没有-p时,可以直接给文件新名字
  
* __clear__

  * 清屏

* __mv__

  * 剪切目录,或者改名

  * mv [原目录]\[新目录]

* __rm__
  * 删除目录/文件
  * 选项:
    * `-f`强制删除
    * `-r`删除目录

#### 1.3 文件

* __touch__
  * ==创建==空文件
  * 用空格隔开创建多个文件,用引号括起让文件名拥有空格
* __cat__
  * 查看文件内容
  * 选项:`-n`显示行号
* __tac__

  * 倒过来显示cat的参数
* __more__

  * 分页显示文件内容

  * 按`空格或f`翻页,`回车`换行,`q`退出,`b`上翻
* __less__

  * 可以往回翻的more
  * 用pageup往上翻页

  * 输入`/`加关键信息搜索,按`n`有next
* __head__
  * head -n 数字 文件
  * 显示文件前几(默认10)行

* __tail__
  * 和head一样,显示文件后几行
  * 选项: `-f`动态显示文件末尾

#### 1.4链接

* __ln__

  * ln -s \[原文件][新链接文件]

  * `-s`软链接,否则硬链接
  * 软链接类似快捷方式,标识为`lrwxrwxrwx`,只是一个符号链接
  * 硬链接权限等信息相同,可以和原文件同步更新,原文件丢失但硬链接依然存在,`inode`与原文件相同

### 2.权限管理命令

* __chmod__

  * root或者user更改文件权限

  * 语法:

    1. chmod \[{ugoa} {+-=}{rwx}][文件或目录]

    * `a`:所有人 ugo分别对应不同人

    * +-就是加减权限,`=`是应该拥有权限

    2. chrome `数字权限` 文件名

  * ==数字表示权限==:

    r----4

    w---2

    x----1

    rwx----7

    以此类推

    rwxrwxrwx-----777
    
  * 选项: `-R`递归修改,把目录下的权限全改了
  
* __chown__

  * 更改文件或目录的所有者

  * 语法: chown \[新所有者:新组][文件或目录]

  * 只有`root`可以改变所有者
  
* __chgrp__

  * 更改文件或目录的所属组
  * 语法: chgrp [新组][文件或目录\]
* __umask__ 

  * 显示新建文件时的缺省权限

  * 选项: `-S`以rwx显示

  * 注意: touch的文件去除x权限

  * 不用-S的0022含义

    `0`特殊权限

    `022`与777__逻辑异或__的结果是默认权限

  * ==umask加新数字改变缺省权限==


#### 2.1. 何为权限

* 对__文件__的含义

  | 字母 | 权限         | 命令                    |
  | ---- | ------------ | ----------------------- |
  | r    | 查看文件内容 | cat/more/less/head/tail |
  | w    | 修改文件内容 | vim                     |
  | x    | 执行文件     | 对script command使用    |

* 对__目录__的含义

  

| 字母 | 权限                      | 命令                 |
| ---- | ------------------------- | -------------------- |
| r    | 能列出目录的内容          | ls                   |
| w    | 可以在目录中创建,删除文件 | touch/mkdir/rmdir/rm |
| x    | 可以进入目录              | cd                   |

* 对目录有权限则可以对文件修改,不管对文件有没有权限

### 3. 文件搜索命令

不建议使用.不如好好排布文件

* __find__:

  * 搜索,严格区分大小写

  * find [范围]\[匹配条件]

  * 选项:

    `-name`根据文件名搜索,通配符`*`匹配任意长度字符,`?`匹配单个字符

    `-iname`不区分大小写

    `-size +(大于) -(小于) =(等于)`按大小查找,单位是数据块(512字节,0.5k)

    `-user``-group`按所有者,所属组查找

    `-amin` 访问时间(...之内外),+=-单位分钟`-cmin` 文件属性`-mmin`文件内容

    `-a`连接两个条件,同时满足,`-o`连接连个条件,任一满足

    `-type`按文件类型(fdl)查找

    `-exec或-ok 命令 {} \;`对文件执行命令

    `-inum`按inode查找

* __locate__

  * 从文件资料库快速查找

  * locate 文件名

  * 选项:

    `-i`不区分大小写
    
    `updatedb`更新数据库
  
* __which__:
  
  * 查找命令
  
* __whereis__:

  * 查找,命令和帮助文档的位置

* __grep__:

  * 在文件内容查找

  * grep 关键词 文件

  * 选项:

    `-i`不区分大小写

    `-v ~字符`去掉有字符的行,加~去 行首为字符的
    
    `-v` 反向查找
    
    `--color=auto` 关键字颜色显示

### 4.帮助命令

* __man__
  * 获取命令的帮助信息
  * man 指令和配置文件(不需要路径)
  * `\加上想要搜索的选项`快速定位选项
  * 选项: `1` 命令 `5` 配置文件

* __whatis__/__info__
  * 加命令直接查help

* __--help__
  * 命令 --help

* __help__
  * 查看shell内置命令
  * help 命令

* __apropos__:
  * 查询配置文件信息

### 5. 用户管理命令

* __useradd__:
  * 添加用户
* __passwd__
  * 改密码
  * passwd 用户名
* __who__

  * 查看登录用户
* __w__
  * 查看当前用户详细信息

### 6. 压缩解压命令

| 压缩格式 | 命令                          | 解压           | 作用                             | 选项                                                         |
| -------- | ----------------------------- | -------------- | -------------------------------- | ------------------------------------------------------------ |
| .gz      | gzip                          | gunzip/gzip -d | 压缩文件,不压缩目录,不保留原文件 |                                                              |
| .tar.gz  | tar -zcf 目标文件.tar.gz 文件 | tar -x         | 打包的同时压缩                   | -c打包<br />-v详细信息<br />-f指定文件名<br />-z/-j打包同时压缩 |
| .zip     | zip 压缩后名 文件或目录       | unzip          | 压缩目录或文件                   | -r 压缩目录                                                  |
| .bz2     | bzip2                         | bunzip2        | gzip的升级版,可以跟tar使用       | -k 保留源文件                                                |
|          |                               |                |                                  |                                                              |
|          |                               |                |                                  |                                                              |
|          |                               |                |                                  |                                                              |
|          |                               |                |                                  |                                                              |
|          |                               |                |                                  |                                                              |

### 7. 网络命令

* __write__
  * 所有登陆的用户
  * write 用户,Ctrl+D结束,ctrl+退格删除一两个字符

* __wall__
  
* 给所有用户发信息
  
* __ping__

  * ping 选项 ip

  * 选项:

    `-c 数字`指定ping的次数

* __ifconfig__

  * 查看网络状态呗

* __mail__

  * 发送电子邮件/查看电子邮件

  * mail 用户名

  * mail 查看

    * h看内容
	* d 序号 删邮件
    * q 退出
  
* __last__
  
  * 显示所有登录过得用户信息
  
* __lastlog__

  * 用户最后登录的信息
  * 选项:`-u`用uid查看

* __traceroute__
  * traceroute加网站或ip
  * 显示数据包到主机的途径

* __netstat__

  * 显示网络相关信息

  * 选项:

    `-t`:TCP协议

    `-u`:UDP协议

    `-l`:监听

    `-r`:路由(网关)

    `-n`:显示ip地址和端口号

    

* __setup__
  
* 设置网络,只有redhat有
  
* __mount__

  * 挂载命令
  * mount [-t 文件系统] 设备文件名 挂载点

  * __umount__ 挂载点  来去掉挂载点

### 8.关机重启命令

* __shutdown__

  * 关机

  * shutdown 选项 时间/now

  * 选项

    `-h`关机

    `-r`重启

    `-c`取消上一个关机命令

* __reboot/init 6__
  
* 重启
  
* 系统运行级别

  0. 关机
  1. 单用户
  2. 不完全多用户 不含NFS服务
  3. 完全多用户
  4. 未分配
  5. 图形界面
  6. 重启

  * 使用`cat /etc/inittab`

* __logout__
  
  * 退出登录

---------

### 9. 时间日期命令

* __date__

  ```bash
  date 显示时间日期
  date "+%Y"显示年份
  date "+%Y %m %d"显示年月日
  date "+%H %M %S"显示时分秒
  date -s 子串 #修改日期时间
  ```

* __cal__

  ```bash
  cal 年份 #显示整年的日历
  ```

  

## 二 .文本编辑器Vim

`vim`是`vi`的升级版全屏幕文本编辑器	

* 工作模式

  ![image-20200304105809708](C:\Users\carrzhou\AppData\Roaming\Typora\typora-user-images\image-20200304105809708.png)

在vim下每一个输入都会以__命令__的形式运行

按`esc`从别的模式会到命令模式

### 1. 输入命令

| 命令 | 作用                 |
| ---- | -------------------- |
| a    | 在光标所在字符后插入 |
| A    | 在光标所在行尾插入   |
| i    | 在光标所在字符前输入 |
| I    | 在光标所在行首插入   |
| o    | 在光标下插入新行     |
| O    | 在光标上插入新行     |

### 2. 定位命令

| 命令      | 作用       |
| --------- | ---------- |
| :set nu   | 设置行号   |
| :set nonu | 取消行号   |
| gg        | 到第一行   |
| G         | 到最后一行 |
| nG        | 到第n行    |
| :n        | 到第n行    |
| $         | 移至行尾   |
| 0         | 移至行首   |

### 3. 删除命令

| 命令     | 作用                           |
| -------- | ------------------------------ |
| dd       | 删除光标所在行                 |
| x        | 删除光标所在处字符             |
| nx/ndd   | 删除光标所在行后n字符/n行      |
| dG       | 删除光标所在行到文件末尾的内容 |
| : n1,n2d | 删除n1到n2行                   |
| D        | 删除光标所在处到行尾的内容     |

### 4.复制剪切命令

| 命令 | 作用              |
| ---- | ----------------- |
| yy   | 复制当前行        |
| nyy  | 复制当前行开始n行 |
| dd   | 剪切当前行        |
| ndd  | 剪切n行           |
| p,P  | 粘贴              |

### 5.替换和取消命令

| 命令 | 作用                   |
| ---- | ---------------------- |
| r    | 取代光标所在处字符     |
| R    | 开始替换模式,按esc技术 |
| u    | 取消上一步操作         |

### 6. 搜索和搜索替换

| 命令              | 作用                              |
| ----------------- | --------------------------------- |
| /字符串           | 搜索指定字符串 `set ic`忽略大小写 |
| n                 | 搜索时,指定字符串下一个出现的位置 |
| :%s/旧/新/g       | 全文替换,把g换成c有询问           |
| :n1,n2s/old/new/g | 在行范围内替换指定字符串          |

### 7. 保存退出命令

| 命令            | 作用                           |
| --------------- | ------------------------------ |
| :w              | 保存修改                       |
| :w new_filename | 另存为文件                     |
| :wq             | 保存修改并退出                 |
| ZZ              | 保存修改并退出                 |
| :q!             | 不保存退出                     |
| :wq!            | 保存修改并退出(user和root使用) |

### 8. 其他命令

* 导入文件内容
  * :r !文件名 

* 查看关于命令的文件名
  * :!which 命令名

> 以上二者可以结合

* __map__
  * 定义快捷键
  * :map 快捷键 操作
  * 举例:map ^P(ctrl+V+P) I#\<ESC>

* 连续行注释
  * :n1,n2s/^/#/g
  * ^表示行首

* ab
  * :ab x y
  * 长期把x换成y

## 三. 软件包管理

* 分类

  > 源码包
  >
  > 二进制包(RPM包)

### 1. rmp命令管理

#### 1.1命名规则(包全名)

* 对于未安装的软件包一般使用包全名

`软件包名`-`软件版本`-`软件发布次数`.`适合的linux平台`.1.`适合的硬件平台`.rpm

#### 1.2 命令

* rpm -ivh 包全名

  * 安装/升级/卸载

  * 选项

    `-i`安装

    `-v`显示详细信息

    `-h`显示进度

    `--nodeps`不检测依赖性

    `-U`升级

    `-e`卸载+包名

#### 1.3 查询方法

* rpm -q 包名

  * 查询包

  * 选项 

    `-q` 查询

    `-qa`查询所有包

    `-qi`查询包基本信息

    `-p`查询未安装包信息

    `-l`列表

    `-f+系统文件名`查询系统文件属于哪个软件包

    `-R`查询依赖性

#### 1.4 校验和文件提取

* 校验 rpm -V
  * `-V`校验文件
  * 8个信息
    1. `S`文件大小是否改变
    2. `M`文件的类型或文件的权限是否被改变
    3. `5`文件MD5校验和是否改变(文件内容)
    4. `D`设备的中,从代码是否改变
    5. `L`文件的路径是否改变
    6. `U`文件的属主是否改变
    7. `G`文件的属组是否改变
    8. `T`文件的修改时间是否改变

* 文件提取
  * rpm2cpio 包全名| \
  * cpio -idv .文件绝对路径

### 2. yum在线管理

* yum `list` 查询所有可用的软件包列表
* yum `search` keyword 查询所有和关键字相关的包
* yum` -y install\update\remove`包名 (-y即自动回答yes)
* yum `grouplist`观看文件组
* yum `groupinstall\groupremove 软件组名`安装整个软件组
* 服务开启: service 服务名 start

### 3. 源码包的安装

![image-20200309144704700](C:\Users\carrzhou\AppData\Roaming\Typora\typora-user-images\image-20200309144704700.png)

源码包安装位置:/usr/local/软件名/

* `./configure`

  选项: `--profix=...`设置安装目录

* `make` 编译
* `make clean`清除文件
* `make install`编译安装

### 4. 脚本安装包

脚本安装包是源码包,但是有自动安装的脚本,类似于windows的安装

----

## 四.用户和用户组管理

### 1.用户信息管理/etc/passwd

第一字段: 用户名称

第二字段:密码标志

第三字段:UID

 * ​	0: 超级用户
 *  1-499:系统用户(伪用户)
 * 500-65535:伪用户

第四字段:GI D(初始组id)

第五字段: 用户信息

第六字段:家目录

第七字段:登陆之后的shell

### 2. 影子文件 /etc/shadow

第一字段:用户名

第二字段:加密密码,!!或*代表不能登陆,没有密码

算法是`SHA512散列加密算法`

第三字段: 密码最后一次修改的日期,从19700101开始,每过一天时间戳+1

第四字段:两次密码的修改间隔

第五字段:密码有效期

第六字段:密码到期之前的警告事件

第七字段:密码过期后的宽限天数,0则没有,-1则永不失效

第八字段: 账号失效时间,用时间戳表示

第九字段:保留字段

### 3.组信息文件/etc/group,/etc/gshadow

第一字段:组名

第二字段:组密码标志

第三字段:GID

第四字段:组中附加用户

-----

第一字段:组名

第二字段:组密码

第三字段:组管理员用户名

第四字段:组中附加用户

-------

### 4. 用户管理类目录

家目录:

> 普通用户:/home/用户名,权限700
>
> 超级用户:/root/,权限550

用户邮箱:

/var/spool/mail/用户名/

用户模板:/etc/skel

### 5. 用户管理命令

* __useradd__ [选项] 用户名

  * 选项:

    `-u UID`手工指定UID

    `-d 目录`手工指定家目录

    `-c 用户说明`手工指定用户说明

    `-g 组名`手工指定初始组

    `-G 组名`手工指定附加组

    `-s shell `手工指定用户登录的shell
  
* __passwd__ [选项] 用户名

  * 选项: 

    `-S`查询用户的密码状态,仅root可用

    `-l`暂时锁定用户,root用

    `-u`解锁用户,root用

    `--stdin` 可以通过管道符输出的数据作为用户的密码

* __usermod__

  * 修改用户信息

  * 选项

    `-u UID`修改UID

    `-c 用户说明` 修改用户说明

    `-G 组名` 修改用户附加组

    `-L/-U`临时锁定/解锁

* __userdel __ -r 用户名

  * 删除用户

  * 选项

    `-r`删除家目录

* __id__ 用户名

  * 查询uid和组

* __su__ 选项 用户名

  * 切换用户身份,把自己变成输入的用户

  * 选项

    `-`连带环境变量一同切换(必选)(独立选项)

    `-c` 不切换用户,在执行命令下执行一条语句

    `su - 用户名 -c 命令`

* __chage__ [选项] 用户名

  * 选项

    `-l` 列出用户的详细密码状态

    `-d 日期` 修改密码的最后一次更改日期

    `-m 天数`修改两次密码的修改间隔

    `-M 天数`密码有效期

    `-W 天数`密码失效前的警告天数

    `-I` 密码过期后的宽限天数

    `-E`账号失效时间

### 6. 用户默认值文件

/etc/default/useradd

### 7. 用户组管理命令

* __groupadd__ [选项] 组名

  * 添加用户组
  * `-g GID` 指定GID

* __groupmod__ [选项] 组名

  * 修改用户组

  * `-g GID`修改id

    `-n 组名`修改组名

* __groupdel__

  * 删组

* __gpasswd__ 选项 组名

  * 把用户添加组或删除组

  * 选项:

    `-a 用户名`把用户加入组

    `-d 用户名` 把用户从组中删除

----

## 五. 权限管理

### 1. ACL权限

#### 1.1 简介

解决权限在ugo之外的情况

* __dumpe2fs__ -h /dev/sda3
  * dumpe2fs是查询指定分区详细文件系统信息的命令
* `-h`仅显示超级快中的信息,而不显示磁盘块组的详细信息
  * 查看分区ACL权限是否开启
* __mount -o remount,acl /__
  * 临时打开acl权限,重新挂载根分区

#### 1.2 命令

* __getfacl__ 文件名
  
* 查看acl权限
  
* __setfacl__ 选项 文件名

  * 设定acl权限

  * setfacl -m u/g:用户名/组名:权限 文件名,删除同理

  * 选项:

    `-m`设定acl权限

    `-x`删除指定acl权限

    `-b`删除所有acl权限

    `-d`设定默认acl权限

    `-k`删除默认acl权限

    `-R`递归设定acl权限

    * mask是最大有效权限,ACL权限与mask相与才能获得真正权限

  * `setfacl -m m:权限` 指定mask权限

  * `d:`递归时默认给新的子文件加上acl权限

### 2. 文件特殊权限

#### 2.1 setUID

只有可执行的二进制程序才能设定SUID权限,命令执行者必须拥有`x`权限.

* 执行者在执行改程序时获得改文件属主的身份.
* setUID权限__只__在该程序执行过程中有效.

命令的所有者在长详细信息有时候在`u`会有`s`权限,即SUID权限,在执行时可以化身为user

* 设置:suid的权限是4,形如`4755`即有suid

#### 2.2 setGID

* 针对文件时和setUID基本一致,不过是用户变成了`所属组`的成员身份.

* 在g方面出现s即setGID权限

* 数字:2,`2755`
* 针对目录时,普通用户必须有r和x权限才能进入此目录,然后变成所属组
* 若有w权限.创建的文件所属组是属组

#### 2.3 sticky BIT

* 只针对目录.数字是`1`,字母是`t`
* 要求用户有w和x权限.用户只能删除自己创建的文件,不能删除别人创建的文件,对root无效.

### 3. chattr权限

* __chattr__ [+-=] [选项] 文件名或目录名

  * 选项

    `i`:对文件,不允许对文件进行删除改名,修改和添加数据;对目录,不能建立和删除文件,只能修改文件数据.对root有效.

    `a`:对文件,只能增加数据,不能修改和删除;对目录,只允许修改和建立,不允许删除.

* __lsattr__ 选项 文件名

  * 查看文件系统属性

  * 选项

    `-a` all

    `-d`针对目录

### 4.系统命令 sudo权限

root把只能超级用户执行的命令赋予普通用户执行.

* __visudo__

  ​	* 实际修改的是/etc/sudoers文件

  * 格式:`用户名 ip(ALL)=(可使用身份) 授权命令的绝对路径`
  * `%组名 ip(ALL)=(可使用身份) 授权命令的绝对路径`

使用时sudo+命令



## 六. 文件系统管理

### 1. 命令

* __df__

  * 查看分区

  * 选项

    `-h`人性化显示大小

    `-a`显示所有文件的系统信息.包括特殊文件系统如/proc,/sysf

* __du__

  * 查看目录或文件大小

  * 选项

    `-h``-a`同上

    `-s`统计总占用量,而不列出子目录文件的占用量

* __fsck__

  * 文件系统修复命令

  * 选项:

    `-a`不显示用户提示

    `-y`自动修复,和-a差不多

* __dumpe2fs__

  * 查看分区的情况
  * dumpe2fs |more 用more形式看内容

* __mount__

  * 挂载命令 [-t 文件系统] [-L 卷标名] \ [-o 特殊选项] 设备文件名 挂载点

  * `-l`显示卷标名称

    `-a`自动挂载

![image-20200323143227305](C:\Users\carrzhou\AppData\Roaming\Typora\typora-user-images\image-20200323143227305.png)



------

# SHELL

```mermaid
graph LR
A[硬件]-->B[内核]-->C[shell命令解释器]-->D(外层应用程序)
```

shell也是一个功能强大的编程语言,可以直接调用linux系统命令.

* 分类:

  > __bourne shell/sh__: 最古老的额
  >
  > * ​	其族群:
  >   * sh,ksh,bash,psh,zsh
  >
  > **C shel**l:在bsd版unix系统中,语法与C语言类似
  >
  > * 族群:
  >   * csh,tcsh

主流是bash,和sh兼容

## 一. shell脚本的执行方式

### 1. echo输出命令

```bash
echo [选项][内容]
# -e:支持转义字符
#小知识: \e[1; 开启颜色输出 \e[0m结束颜色输出
#\e[1;颜色 字符串\e[0m
```

颜色: 30m黑 31m红 32m绿 33m黄 34m蓝 35m洋红 36m青色 37m白色

---

### 2. 脚本文件.sh

* 编写脚本

```bash
vim hello.sh
#----------------------内容

#!/bin/Bash           \\第一行必须标注是shell程序
#The first program
~
echo ' balabala'; &#末尾的&代表后台运行
:q
```

* 执行脚本

1. 赋予执行权限,直接运行

   ```bash
   chmod 755 hello.sh
   ./hello.sh
   ```

2. bash调用

   ```bash
   bash hello.sh
   ```

   

* __注意__:Windows脚本编辑时回车是`M$`形式,而linux是`$`形式,不能直接执行,此时使用__doc2unix__命令转换脚本

## 二. bash的基本功能

### 1. 历史命令和自动补全

```bash
history [选项] [历史命令保存文件]
#-c: 清空历史命令
#-w: 把缓存中的历史命令写入命令保存文件~/.bash_history
```

调用历史命令:

* 用上下箭头调用历史命令
* 用`!n`重复执行第n条历史命令
* `!!`重复执行上一条命令
* `!字符串`重复执行最后一条以字符串开头的命令

----

### 2. 命令别名和快捷键

```bash
alias 命令='别名';
alias #查询别名
unalias
```

第一顺位执行路径执行的命令,

第二顺位优先别名,

第三顺位bash命令

第四顺位 按$PATH环境变量寻找的第一个

别名永久生效:配置文件`/root/.bashrc`

* 快捷键

![image-20200326142857729](C:\Users\carrzhou\AppData\Roaming\Typora\typora-user-images\image-20200326142857729.png)

----------

### 3. 输入输出重定向

输入`/dev/stdin` 数字0

输出`/dev/stdout` 数字1

错误流`/dev/stderr `数字2

#### 3.1 输出重定向

把输出放到文件中,称为输出重定向

```bash
命令 > 文件   #以覆盖方式把命令输出到设备或文件
命令 >> 文件  #以追加方式把命令输出到设备或文件
错误命令 2> 文件 #以覆盖方式把错误命令输出到设备或文件
错误命令 2>> 文件 #以追加方式把错误命令输出到设备或文件

ls>abc#举例
```

```bash
命令 >文件 2>&1
命令 &>文件
 #以覆盖方式把正确和错误命令输出到设备或文件

命令 >>文件 2>&1
命令 &>>文件
#以追加方式把正确错误命令输出到设备或文件
命令>>文件1 2>>文件2
#正确和错误分别写入,追加,如果用覆盖两个都会被清空然后那啥
```

#### 3.2 输入重定向

从文件输入命令

```bash
wc [选项] [文件名]
# -c 统计字节数
# -w 统计单词数
# -l 统计行数
# ctrl+d 随便输入,返回统计
# wc << hello 输入到hello
```

---

### 4. 多命令顺序执行和管道符

#### 4.1 多命令顺序执行

| 符号 | 格式         | 作用                                                   |
| ---- | ------------ | ------------------------------------------------------ |
| ;    | 命令;命令    | 多个命令顺序执行,不考虑逻辑关系                        |
| &&   | 命令&&命令   | 命令1正确执行则命令二执行;命令一不正确执行,命令2不执行 |
| \|\| | 命令\|\|命令 | 命令1执行不正确则命令2执行;否则命令2不执行             |

* dd命令(复制命令)

```bash
dd if=输入文件/设备 of=输出文件/设备 bs=字节数 count=个数
#bs:多少字节一个数据块
# count:多少个数据块
```

#### 4.1 管道符

```bash
命令1 | 命令2
#命令1的正确输出作为命令2的操作对象
```

-------

## 三. bash变量

变量默认类型全部为__字符串__型.

### 1. 概述

```bash
name=efefefe #定义变量name值为efefefe
```

* 赋值符号左右两侧__不能有空格__

* 值存在空格则用单引号或双引号包含

* 可以使用转义符

* 变量值可以叠加,不过变量需要用`"$变量名"`或者`${变量名}`包含

* 把__命令返回值__赋给变量

  ```bash
  #格式
  name=`ls`
  #或
  name=$(ls)
  ```

* 环境变量建议大写

* readonly变量不能unset

```bash
readonly a=123
```



* 分类:

> **用户自定义变量**
>
> **环境变量**:保存和操作系统环境相关的数据
>
> **位置参数变量**:用来向脚本当中传递参数或者数据,变量名不能自定义.
>
> **预定义变量**:bash中已经定义好的变量,变量名不能自己定义

### 2. 用户自定义变量/本地变量

* 变量定义/叠加

  ```bash
  #见概述
  name="efefef efef" #变量定义
  echo $name
  
  #叠加
  aa="$aa"456
  aa=${aa}789
  echo aa
  >123456789
  ```

* 查看和删除

  ```bash
  set #查看所有变量
  unset name #删除变量
  ```

### 3. 环境变量

环境变量会在当前shell和shell的所有子shell中生效.写入配置文件则对所有shell生效

```bash
export 变量名=变量值 #声明环境变量,变量可以是已有环境变量

env #查看环境变量
```

### 4. 位置参数变量

位置参数的变量名称是固定的

> * `$n`:n代表数字,\$0表示命令本身,\$1-9表示第一到第九个参数,十以上需要大括号 如`${10}`
>
> * `$*`:代表命令行的所有参数,所有参数看做一个整体
> * `$@`:代表命令行的所有参数,所有参数区分对待
> * `$#`:命令行中所有参数的个数

```bash
!/bin/bash
echo $0
echo $1
#以上为脚本文件

#运行结果:
#输出运行命令
#输出参数
./aaa.sh 11
> ./aaa.sh
> 11
```

### 5. 预定义变量

根本不能改的变量

> `$?`:上一个命令的返回状态,0是正常执行,否则不是
>
> `$$`:当前进程的进程号(PID)
>
> `$!`:后台运行的最后一个进程的进程号

### 6. 接收键盘输入

```bash
read [选项] [变量名]
# -p "提示信息"  显示提示信息
# -t 秒数       等待用户输入的最大时间
# -n 字符数      指定输入字符数
# -s:隐藏输入数据,比如输密码         
```

## 四. bash变量的操作

### 1. 数值运算与运算符

在linux中所有变量默认为字符串,所以直接使用运算符不能数值运算.

#### 1.1 declare

```bash
#声明变量类型
declare [+/-][选项] 变量名
# -:给变量设定类型属性
# +:取消变量类型属性
# i:整型
# x:环境变量
# p:显示查看变量被声明的类型
```

* 使用案例

  ```bash
  aa=11
  bb=12
  
  declare -i cc=$aa+$bb
  cc : 23
  ```

  

#### 1.2 expr或let运算工具

```bash
dd=$(expr $aa + $bb)
#加好左右两侧必须有空格
#此时dd是aa和bb的和
```

## 五. 环境变量配置文件

* __source__

  ```bash
  source 配置文件
  #强制让修改过的配置文件生效
  . 配置文件 #source命令的缩写
  ```

* 配置文件

  > * /etc/profile
  > * /etc/profile.d/*.sh
  > * ~/.bash_profile
  > * ~/.bashrc          (这两个是用户对应家目录,只对用户有效)
  > * /etc/bashrc

### 1. profile

![image-20200331145501344](C:\Users\carrzhou\AppData\Roaming\Typora\typora-user-images\image-20200331145501344.png)

### 2. 其他

`/.bash_logout` 注销时的环境变量

`/.bash_history` 历史命令文件

`/etc/issue` 本地终端欢迎信息

![image-20200401124054916](C:\Users\carrzhou\AppData\Roaming\Typora\typora-user-images\image-20200401124054916.png)

`/etc/issue.net`远程终端欢迎信息,不能用转义符

`/etc/motd` 登录之后的欢迎信息

## 六. shell编程

### 1. 基础正则表达式

正则表达式是用来在__文件中__匹配__符合条件的字符串__.grep,awk,sed等支持正则表达式,是__包含匹配__

> 拓展:Linux通配符,负责__匹配文件名__,`*`,`?`,`[]`,分别代表任意字符,单个字符,可选字符,属于__完全匹配__.可用在ls,find,cp中匹配.

| 元字符    | 作用                                                         |
| --------- | ------------------------------------------------------------ |
| *         | 前一个字符匹配0次或任意多次                                  |
| .         | 匹配除了换行符外的任一字符                                   |
| ^         | 匹配行首,如^hello会匹配hello开头的行                         |
| $         | 匹配行尾,,如hello$匹配以hello结尾的行                        |
| []        | 匹配任一号中字符,如[aeiou],[0-9],[a-z]                       |
| [^]       | 匹配除括号字符以外的任一字符,\[\^0-9\],\[^a-z\]              |
| \         | 转义符                                                       |
| \\{n\\}   | 表示前面的的字符恰好出现n次,如`[0-9]\{4\}`表示任意数字出现4次 |
| \\{n,\\}  | 表示前面字符出现不小于n次                                    |
| \\{n,m\\} | 表示前面字符出现n~m次(包含)                                  |
|           |                                                              |

### 2. 字符截取命令

* __cut__

  ```bash
  cut  选项 文件名
  # -f 列号,列号   指定提取第几列
  # -d 分隔符  按指定分隔符分割列
  
  cut -f 2,4 student
  cut -d ":" -f 1 student
  #局限性:分隔符不能是空格
  ```

  

* __printf__

  ```bash
  printf '输出类型格式' 输出内容
  # %ns n位字符串
  # %ni n位整数
  # %m.nf 浮点数
  ```


* __awk__

```bash
awk '条件1{动作1}条件2{}...' 文件名
#条件:如关系表达式,BEGIN(读取数据之前执行),END(结束后)
#动作:printf,流程控制语句
#条件可以不写,相当于1

awk '{printf $2 "\t" $4 "\n"}'
#打印2,4列

#FS=... 指定分隔符,在条件中
awk {FS=";"}{printf...}
```

* __sed__

  ```bash
  #是轻量级流编辑器
  #可以选取,替换,删除,新增 命令的结果
  sed [选项] '动作' 文件名
  # -n 把经过sed处理的行输出到屏幕
  # -e 允许对输入数据应用多条sed命令便捷
  # -i 用sed的修改结果直接修改读取数据的文件,而不是屏幕输出
  #--------------------------
  # a \ 追加(在每行末尾加\表示命令未完结)
  # c \ 替换
  # i \ 插入
  # d 删除
  # p 打印
  # s 子串替换
  
  sed -n '2p' 文件 #输出第二行
  sed '2a hello' student.txt
  ```

------

### 3. 字符处理命令

* __sort__

  ```bash
  sort 选项 文件名
  #按首字母顺序给行排序
  # -f 忽略大小写
  # -r 倒序
  # -t 分隔符 -k n,m 
  #指定分隔符,从n到m字段排序\
  # -n 以数值型排序
  ```

* __wc__

  ```bash
  wc 选项 文件名
  # 统计行数,单词数,字符数
  # -l 只统计行数
  # -w 只统计单词
  # -m 只统计字符
  ```

  

### 4. 条件判断

![image-20200404105604763](C:\Users\carrzhou\AppData\Roaming\Typora\typora-user-images\image-20200404105604763.png)

```bash
#两种格式
test 选项 文件
[选项 文件]
```

![image-20200404110035865](C:\Users\carrzhou\AppData\Roaming\Typora\typora-user-images\image-20200404110035865.png)

![image-20200404110138612](C:\Users\carrzhou\AppData\Roaming\Typora\typora-user-images\image-20200404110138612.png)

![image-20200404110257898](C:\Users\carrzhou\AppData\Roaming\Typora\typora-user-images\image-20200404110257898.png)

---

## 七. 流程控制

### 1. if语句

配合上面的`条件判断`使用.

* __单分支__

```bash
if [ 条件判断式 ] ; then
	程序
fi

或者

if [ 条件判断 ]
	then
		程序
fi

```

* __双分支__

  ``` bash
  if [ 条件判断式]
  	then
  		程序
  	else
  		程序
  fi
  ```

  

### 2. case语句

```bash
case $变量名 in
	"值1")
		程序1
		;;
	"值2")
		程序2
		;;
	*)
		程序n
		;;
	esac
```

### 3. for语句

```bash
for 变量 in 值1 值2 ...
	do
		程序
	done
	
#或者

for (( 初始1;判断2;操作3 ))
	do
		程序
	done
```

### 4. while语句

```bash
while [条件判断]
	do
		程序
	done
```

### 5. until语句

```bash
until [条件判断]
	do
		程序
	done
```



## 八. 系统函数

### 1. basename

返回完整路径最后/的部分,常用于获取文件名

```bash
basename /home/aaa/test.txt #返回test.txt
basename /home/aaa/test.txt .txt #去除后缀名,返回test
```

### 2. dirname

返回完整路径最后/前面的部分(路径)

## 九.自定义函数

```bash
[function] funname[()]
{
	Action;
	[return int;]
}
```

![image-20200504125626752](C:\Users\carrzhou\AppData\Roaming\Typora\typora-user-images\image-20200504125626752.png)

# Linux

## 一. 服务管理

### 1. 服务管理命令

```bash
systemctl 服务名 [start|stop|restart|reload|status]
```

端口测试

```bash
telnet ip 端口 #可是在CentOs8用不了
```

### 2. 查看所有服务

```bash
setup #用不了
nmtui #用的了
ls /etc/init.d #这个目录下都是服务
```

### 3. 查看/设置运行级别对应的服务

```bash
chkconfig --list #查看
chkconfig --level 级别 服务名 on/off #设置自启动/不自启动
```





## 二. 定时任务调度

crontab机制可以定时调用脚本或者代码.

```bash
crontab #-e 编辑 -l查询,-r 删除所有任务
crontab -e 
*/1 * * * * ls -l 
#各个位分别代表
#第几分钟
#第几小时
#月中第几天
#第几月
#星期几
#*/1代表每分钟
```

----------

## 三. 进程管理

### 1. 基本介绍

每个执行的程序就是一个进程,各有各的id

每个进程都有一个__父进程__

分为__前台和后台__进程

### 2. 查看系统执行的进程

```bash
ps -aux
# a:显示当前终端的所有进程
# u: 以用户的格式显示进程信息
# x:显示后台进程运行的参数
ps -ef
# 查看父进程ID(PPID)
#e :显示所有进程
#f :全格式

pstree [选项] #树状观察
# p:pid
# u:user
```

* __结果分析__:

  ```bash
  ps -aux
  USER PID   %CPU        %MEM    VSZ     RSS      TTY      STAT START   TIME COMMAND
  #用户名 进程id 占用CPU情况 占用内存 虚拟内存 物理内存 终端号     当前状态 开始时间 占用CPU总计时间 进程执行时的命令行 
  
  #STAT参数:
  	# S-睡眠
  	# R-运行
      # Z-僵死
      # D-短时等待
      
  ps -ef
  UID         PID   PPID  C STIME TTY          TIME CMD
  #关注ppid 父进程
  ```

  

###  3. 终止进程(kill/killall)

```bash
kill [选项] 进程号 #用进程号杀死进程
# -9 :强制杀死

killall 进程名 #用进程名杀死进程,支持通配符
```

* __举例__:

  ```bash
  kill 4010 ; #踢出用户(假设对应进程为4010)
  killall 'gedit*';
  ```

  

### 4. 动态监控进程(top)

```

```

top

## 五. 查看端口

netstat -anp

lsof -i:端口号